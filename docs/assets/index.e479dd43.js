import{d as e,a as t,c as o,b as n,e as r,o as a,r as l,f as i,F as s,g as c,h as u,i as d,j as p,w as h,v as m,k as f,t as g,l as w}from"./vendor.41235a61.js";!function(e=".",t="__import__"){try{self[t]=new Function("u","return import(u)")}catch(o){const n=new URL(e,location),r=e=>{URL.revokeObjectURL(e.src),e.remove()};self[t]=e=>new Promise(((o,a)=>{const l=new URL(e,n);if(self[t].moduleMap[l])return o(self[t].moduleMap[l]);const i=new Blob([`import * as m from '${l}';`,`${t}.moduleMap['${l}']=m;`],{type:"text/javascript"}),s=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(i),onerror(){a(new Error(`Failed to import: ${e}`)),r(s)},onload(){o(self[t].moduleMap[l]),r(s)}});document.head.appendChild(s)})),self[t].moduleMap={}}}("/zelda-words/assets/");function v(e){return("00000000"+e).slice(-8)}function y(e,t){let o=Math.max(e,t),n=Math.min(e,t);return o%n==0?n:y(o%n,n)}function b(e,t){return e*t/y(e,t)}function C(e,t){const o=document.createElement("canvas");return o.width=e,o.height=t,o}function k(e){console.log("createHeadMeta",e);const t=v(Number(e.vertical).toString(2)),o=v(e.size.toString(2)),n=Math.floor(e.width/e.size);if(n>255)throw new Error("图片尺寸过大！");const r=t+o+v(n.toString(2)),a=b(e.width,24),l=Math.floor(a/e.width*e.size),i=C(a,l),s=i.getContext("2d"),c=a/24,u=function(e,t,o){const n=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);if(n)return`rgba(${[parseInt(n[1],16),parseInt(n[2],16),parseInt(n[3],16)].map((e=>{const t=e+o;return t%255!==t?e-o:t})).join(",")},${t})`;return""}(e.backgroundColor,1,2);s.fillStyle=u;for(let d=0;d<24;d++)Number(r[d])&&s.fillRect(d*c,0,c,l);return i}function S(e,t){const o=function(e){const t=document.createElement("canvas");return t.width=e.width,t.height=e.height,t.getContext("2d").putImageData(e,0,0),t}(new ImageData(e,t.width,t.height)),n=k(t),r=o.getContext("2d"),a=Math.floor(o.width/n.width*n.height);return r.drawImage(n,0,0,n.width,n.height,0,0,o.width,a),o}function x(e){const t=(e=>{const t=(e,t,o)=>Math.floor(.299*e+.587*t+.114*o);for(let o=0;o<e.width;o++)for(let n=0;n<e.height;n++){const r=4*(o+n*e.width),a=t(e.data[r+0],e.data[r+1],e.data[r+2]);e.data[r+0]=a,e.data[r+1]=a,e.data[r+2]=a,e.data[r+3]=255}return e})(e),{width:o,height:n,data:r}=t,a=(e=>{let t=0;for(let o=0;o<e.length-1;o+=4)t+=e[o];return Math.round(t/(e.length/4))})(r),l=r[0]>a?[0,1]:[1,0],i=new Uint8Array(o*n);for(let s=0;s<o;s++)for(let e=0;e<n;e++){const t=e*o+s,n=r[4*t]>a?l[0]:l[1];i.set([n],t)}return i}function z(e,t,o){const n=C(t,t);n.getContext("2d").putImageData(e,0,0);const r=C(o,o).getContext("2d");r.drawImage(n,0,0,t,t,0,0,o,o);return r.getImageData(0,0,o,o)}async function I(e){const t=await function(e){return new Promise(((t,o)=>{const n=new Image;n.onload=()=>t(n),n.onerror=e=>o(e),n.src=e}))}(e),{naturalWidth:o,naturalHeight:n}=t;let r=b(o,24),a=r/o,l=Math.round(a*n);const i=r*l;if(i>16777216){const e=16777216/i;r=Math.floor(r*e),l=Math.floor(l*e),a=r/o}const s=C(r,l).getContext("2d");s.drawImage(t,0,0,o,n,0,0,r,l);const c=function(e,t,o){const n=Math.floor(t/24),r=[];for(let u=0;u<24;u++){const t=e.getImageData(u*n,0,n,4),o=4*(2*n+Math.floor(n/2));r.push(t.data[o]+t.data[o+1]+t.data[o+2])}const[a]=r,l=r.map((e=>e===a?0:1)).join(""),i=parseInt(l.slice(0,8),2),s=parseInt(l.slice(8,16),2),c=parseInt(l.slice(16),2);return{vertical:!!i,size:Math.round(s*o),wdith:Math.round(s*c*o)}}(s,r,a);console.log("readHeadInfo",c);const{grids:u,row:d,col:p}=function(e,t){const{width:o,height:n,size:r,fingerprint:a}=t,l=Math.floor(o/r),i=Math.floor(n/r);console.log({w:l,h:i});const s=Array.from({length:l*i}).fill(null);for(let c=1;c<l-1;c++)for(let t=1;t<i-1;t++){const o=x(z(e.getImageData(c*r,t*r,r,r),r,a));s[t*l+c]=o}return{grids:s.filter((e=>!!e)),row:i-2,col:l-2}}(s,{width:r,height:l,size:c.size,fingerprint:8});return{hashList:u,row:d,col:p,headMeta:c}}async function M(e,t){const o=await I(t),n=o.hashList.map(((e,t)=>({name:"abcdefghijklmnopqrstuvwxyz0123456789.-!?"[t],value:e})));const r=await I(e);return function(e,t){const{row:o,col:n,vertical:r}=t;if(console.log(e),e.every((e=>" "===e)))return"图片文字颜色相差较小无法检察出图片！";let a="";if(r)for(let l=0;l<n;l++){for(let t=0;t<o;t++)a+=e[t*n+l];a+="\n"}else for(let l=0;l<o;l++){for(let t=0;t<n;t++)a+=e[l*n+t];a+="\n"}return a}(function(e,t){return e.map((e=>{if(e.every((t=>t===e[0])))return" ";let o=Number.MAX_SAFE_INTEGER,n=" ";return t.forEach((t=>{const r=((e,t)=>{let o=0;return e.forEach(((e,n)=>{o+=e^t[n]})),o})(e,t.value);r<o&&r<5&&(o=r,n=t.name)})),n}))}(r.hashList,n),{row:r.row,col:r.col,vertical:r.headMeta.vertical})}const P=/Android|iPhone|webOS|BlackBerry|SymbianOS|Windows Phone|iPad|iPod/i.test(window.navigator.userAgent);async function U(t,o){if(!t)return Promise.resolve("");const n=S(await e.toPixelData(t,{filter:e=>function(e){e instanceof SVGElement&&Array.from(e.querySelectorAll("use")||[]).forEach((t=>{const o=t.getAttribute("xlink:href");if(o&&!e.querySelector(o)){const t=document.querySelector(o);t&&e.insertBefore(t.cloneNode(!0),e.children[0])}}));return!0}(e)}),o).toDataURL("image/jpeg",1);if(!P){const e=document.createElement("a");return e.download=`zelda-words-${Date.now()}.jpeg`,e.href=n,e.click(),""}return n}var $=t({name:"WordIcon",props:{name:{type:String,required:!0},width:{type:[Number,String],default:""},height:{type:[Number,String],default:""},color:{type:String,default:""},opacity:{type:String,default:""}},setup:e=>({fullName:o((()=>`#icon-${e.name}`)),iconStyle:o((()=>{const t={};return e.color&&(t.color=e.color),null!=e.width&&(t.width="number"==typeof e.width?`${e.width}px`:e.width),null!=e.height&&(t.height="number"==typeof e.height?`${e.height}px`:e.height),null!=e.opacity&&(t.opacity=e.opacity),t}))})});$.render=function(e,t,o,l,i,s){return a(),n("svg",{class:"word-icon","aria-hidden":"true",style:e.iconStyle},[e.name?(a(),n("use",{key:0,"xlink:href":e.fullName},null,8,["xlink:href"])):r("",!0)],4)};var E={0:"0",1:"1",2:"2",3:"3",4:"4",5:"5",6:"6",7:"7",8:"8",9:"9",a:"a",b:"b",c:"c",d:"d",e:"e",f:"f",g:"g",h:"h",i:"i",j:"j",k:"k",l:"l",m:"m",n:"n",o:"o",p:"p",q:"q",r:"r",s:"s",t:"t",u:"u",v:"v",w:"w",x:"x",y:"y",z:"z",".":"period","!":"exclam","?":"question","-":"hyphen"},D=t({name:"WordsPanel",components:{WordIcon:$},props:{words:{type:String,required:!0},size:{type:String,default:"60"},fontColor:{type:String,required:!0},backgroundColor:{type:String,required:!0},vertical:{type:Boolean,default:!1}},setup:e=>{const t=l(null),n=o((()=>{let t=0,o=0;const n=Number(e.size),r=e.words.toLowerCase().split("\n").map((r=>{const a=r.length*n;t=Math.max(a,t),o+=Number(n);return{style:e.vertical?{width:`${n}px`,height:`${a}px`}:{width:`${a}px`,height:`${n}px`},items:r.split("").map((e=>E[e]||""))}}));t+=2*n,o+=2*n;const a=e.vertical?o:t,l=e.vertical?t:o;return{items:r,containerWidth:a,containerHeight:l,style:{width:`${a}px`,height:`${l}px`,padding:`${n}px`,color:e.fontColor,backgroundColor:e.backgroundColor}}}));return{container:t,groups:n,download:()=>U(t.value,{size:Number(e.size),message:e.words,vertical:e.vertical,fontColor:e.fontColor,backgroundColor:e.backgroundColor,width:n.value.containerWidth,height:n.value.containerHeight}).catch((e=>{window.alert(e.message||"图片导出出错！"),console.log(e)}))}}});D.render=function(e,t,o,r,l,u){const d=i("WordIcon");return a(),n("section",{class:["words-panel",{"words-panel--vertical":e.vertical}],ref:"container",style:e.groups.style},[(a(!0),n(s,null,c(e.groups.items,((t,o)=>(a(),n("div",{class:"words-panel__groups",key:o,style:t.style},[(a(!0),n(s,null,c(t.items,((t,o)=>(a(),n(d,{key:o,name:t,width:e.size,height:e.size},null,8,["name","width","height"])))),128))],4)))),128))],6)};var L=t({name:"ParsePanel",props:{url:{type:String,default:""}},setup:(e,t)=>{const n=l(null),r=l(!1),a=l(""),i=o((()=>r.value?"图片解析中......":a.value)),s=()=>t.emit("close"),c=e=>{n.value.contains(e.target)||s()};return u((()=>{document.body.addEventListener("click",c,!1),(async()=>{r.value=!0;try{a.value=await M(e.url,"/zelda-words/assets/map.f2b776e1.jpeg")}catch(t){console.log(t),a.value=t.message||"图片信息解析出错！"}r.value=!1})()})),d((()=>{document.body.removeEventListener("click",c,!1)})),{container:n,message:i,close:s}}});const j={ref:"container",class:"parse-panel"};L.render=function(e,t,o,r,l,i){return a(),n("section",j,[p("span",{class:"parse-panel__close",onClick:t[1]||(t[1]=(...t)=>e.close&&e.close(...t))},"×"),h(p("textarea",{class:"parse-panel__message","onUpdate:modelValue":t[2]||(t[2]=t=>e.message=t)},null,512),[[m,e.message]])],512)};var _=t({name:"Download",props:{url:{type:String,default:""}},setup:(e,t)=>{const o=l(null),n=e=>{o.value.contains(e.target)||t.emit("close")};return u((()=>{document.body.addEventListener("click",n,!1)})),d((()=>{document.body.removeEventListener("click",n,!1)})),{container:o}}});const N={ref:"container",class:"download"};_.render=function(e,t,o,r,l,i){return a(),n("section",N,[p("img",{src:e.url},null,8,["src"])],512)};var q=t({name:"App",components:{WordsPanel:D,ParsePanel:L,Download:_},setup:()=>{const e=l("60"),t=l("#13c2fe"),n=l("#12181a"),r=l(!1),a=l("hello world"),i=l(null),s=l(!1),c=o((()=>{let t=Number(e.value);return t=t%2==0?t:t-1,t=Math.max(20,t),t=Math.min(200,t),String(t)})),u=l(!1),d=l(""),p=l(!1),h=l("");return{size:e,limitSize:c,resetSize:()=>{e.value=c.value},fontColor:t,backgroundColor:n,vertical:r,words:a,loading:s,wordsPanel:i,downloadImage:async()=>{const e=i.value||{download:()=>{}};s.value=!0;const t=await e.download();t&&(d.value=t,u.value=!0),s.value=!1},uploadImage:({target:e})=>{const[t]=e.files;h.value=URL.createObjectURL(t),p.value=!0,e.value=""},parseImageUrl:h,showParsePanel:p,showDownload:u,downloadUrl:d}}});const R={class:"container"},A={class:"header"},W={class:"color-input",for:"font-color-input"},O=p("span",null,"Font Color：",-1),V={class:"color-input",for:"background-color-input"},B=p("span",null,"Background Color：",-1),F={class:"color-input",for:"vertical-radio"},H=p("span",null,"Vertical：",-1),T={class:"color-input",for:"font-size-input"},G=p("span",null,"Font Size：",-1),X={class:"button-input",for:"image-upload"},J=p("span",null,"Parse Image",-1),K={class:"content"},Q={class:"results"};q.render=function(e,t,o,l,s,c){const u=i("WordsPanel"),d=i("ParsePanel"),w=i("Download");return a(),n("main",R,[p("section",A,[p("label",W,[O,h(p("input",{type:"color",id:"font-color-input","onUpdate:modelValue":t[1]||(t[1]=t=>e.fontColor=t)},null,512),[[m,e.fontColor]])]),p("label",V,[B,h(p("input",{type:"color",id:"background-color-input","onUpdate:modelValue":t[2]||(t[2]=t=>e.backgroundColor=t)},null,512),[[m,e.backgroundColor]])]),p("label",F,[H,h(p("input",{type:"checkbox","onUpdate:modelValue":t[3]||(t[3]=t=>e.vertical=t)},null,512),[[f,e.vertical]])]),p("label",T,[G,h(p("input",{type:"number",id:"font-size-input",min:"20",max:"200",step:"2","onUpdate:modelValue":t[4]||(t[4]=t=>e.size=t),onBlur:t[5]||(t[5]=(...t)=>e.resetSize&&e.resetSize(...t))},null,544),[[m,e.size]])]),p("label",X,[J,p("input",{type:"file",id:"image-upload",accept:"image/*",onChange:t[6]||(t[6]=(...t)=>e.uploadImage&&e.uploadImage(...t))},null,32)]),p("span",{class:"button-input",onClick:t[7]||(t[7]=(...t)=>e.downloadImage&&e.downloadImage(...t))},g(e.loading?"Download...":"Download"),1)]),p("section",K,[h(p("textarea",{class:"words",placeholder:"input...","onUpdate:modelValue":t[8]||(t[8]=t=>e.words=t)},null,512),[[m,e.words]]),p("div",Q,[p(u,{ref:"wordsPanel",words:e.words,size:e.limitSize,vertical:e.vertical,fontColor:e.fontColor,backgroundColor:e.backgroundColor},null,8,["words","size","vertical","fontColor","backgroundColor"])])]),e.showParsePanel?(a(),n(d,{key:0,url:e.parseImageUrl,onClose:t[9]||(t[9]=t=>e.showParsePanel=!1)},null,8,["url"])):r("",!0),e.showDownload?(a(),n(w,{key:1,url:e.downloadUrl,onClose:t[10]||(t[10]=t=>e.showDownload=!1)},null,8,["url"])):r("",!0)])},function(e){const t="ICON_FONT_SCRIPT";if(document.querySelector(`#${t}`)||!e)return;const o=document.createElement("script");o.id=t,document.body.appendChild(o),o.src=e}("//at.alicdn.com/t/font_2375469_s4wmtifuqro.js"),w(q).mount("#app");
