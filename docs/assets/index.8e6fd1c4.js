var e=Object.prototype.hasOwnProperty,t=Object.getOwnPropertySymbols,o=Object.prototype.propertyIsEnumerable,n=Object.assign,r=(n,r)=>{var a={};for(var l in n)e.call(n,l)&&r.indexOf(l)<0&&(a[l]=n[l]);if(null!=n&&t)for(var l of t(n))r.indexOf(l)<0&&o.call(n,l)&&(a[l]=n[l]);return a};import{d as a,a as l,c as s,b as i,e as u,o as c,r as d,f as p,F as f,g as h,h as m,i as g,j as w,w as v,v as y,k as b,t as k,l as x}from"./vendor.41235a61.js";!function(e=".",t="__import__"){try{self[t]=new Function("u","return import(u)")}catch(o){const n=new URL(e,location),r=e=>{URL.revokeObjectURL(e.src),e.remove()};self[t]=e=>new Promise(((o,a)=>{const l=new URL(e,n);if(self[t].moduleMap[l])return o(self[t].moduleMap[l]);const s=new Blob([`import * as m from '${l}';`,`${t}.moduleMap['${l}']=m;`],{type:"text/javascript"}),i=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(s),onerror(){a(new Error(`Failed to import: ${e}`)),r(i)},onload(){o(self[t].moduleMap[l]),r(i)}});document.head.appendChild(i)})),self[t].moduleMap={}}}("/zelda-words/assets/");const C=/Android|iPhone|webOS|BlackBerry|SymbianOS|Windows Phone|iPad|iPod/i.test(window.navigator.userAgent);async function S(e,t){if(!e)return Promise.resolve("");const o=await a.toJpeg(e,{filter:e=>function(e){e instanceof SVGElement&&Array.from(e.querySelectorAll("use")||[]).forEach((t=>{const o=t.getAttribute("xlink:href");if(o&&!e.querySelector(o)){const t=document.querySelector(o);t&&e.insertBefore(t.cloneNode(!0),e.children[0])}}));return!0}(e),quality:1});if(!C){const e=document.createElement("a");return e.download=`zelda-words-${Date.now()}.jpeg`,e.href=o,e.click(),""}return o}var z=l({name:"WordIcon",props:{name:{type:String,required:!0},width:{type:[Number,String],default:""},height:{type:[Number,String],default:""},color:{type:String,default:""},opacity:{type:String,default:""}},setup:e=>({fullName:s((()=>`#icon-${e.name}`)),iconStyle:s((()=>{const t={};return e.color&&(t.color=e.color),null!=e.width&&(t.width="number"==typeof e.width?`${e.width}px`:e.width),null!=e.height&&(t.height="number"==typeof e.height?`${e.height}px`:e.height),null!=e.opacity&&(t.opacity=e.opacity),t}))})});z.render=function(e,t,o,n,r,a){return c(),i("svg",{class:"word-icon","aria-hidden":"true",style:e.iconStyle},[e.name?(c(),i("use",{key:0,"xlink:href":e.fullName},null,8,["xlink:href"])):u("",!0)],4)};var I={0:"0",1:"1",2:"2",3:"3",4:"4",5:"5",6:"6",7:"7",8:"8",9:"9",a:"a",b:"b",c:"c",d:"d",e:"e",f:"f",g:"g",h:"h",i:"i",j:"j",k:"k",l:"l",m:"m",n:"n",o:"o",p:"p",q:"q",r:"r",s:"s",t:"t",u:"u",v:"v",w:"w",x:"x",y:"y",z:"z",".":"period","!":"exclam","?":"question","-":"hyphen"},P=l({name:"WordsPanel",components:{WordIcon:z},props:{words:{type:String,required:!0},size:{type:String,default:"60"},fontColor:{type:String,required:!0},backgroundColor:{type:String,required:!0},vertical:{type:Boolean,default:!1}},setup:e=>{const t=d(null),o=s((()=>{let t=0,o=0;const n=Number(e.size),r=e.words.toLowerCase().split("\n").map((r=>{const a=r.length*n;t=Math.max(a,t),o+=Number(n);return{style:e.vertical?{width:`${n}px`,height:`${a}px`}:{width:`${a}px`,height:`${n}px`},items:r.split("").map((e=>I[e]||""))}}));t+=2*n,o+=2*n;const a=e.vertical?o:t,l=e.vertical?t:o;return{items:r,containerWidth:a,containerHeight:l,style:{width:`${a}px`,height:`${l}px`,padding:`${n}px`,color:e.fontColor,backgroundColor:e.backgroundColor}}}));return{container:t,groups:o,download:()=>S(t.value,(Number(e.size),e.words,e.vertical,e.fontColor,e.backgroundColor,o.value.containerWidth,o.value.containerHeight)).catch((e=>{window.alert(e.message||"图片导出出错！"),console.log(e)}))}}});function E(e){const t=(e,t,o)=>Math.floor(.299*e+.587*t+.114*o);for(let o=0;o<e.width;o++)for(let n=0;n<e.height;n++){const r=4*(o+n*e.width),a=t(e.data[r+0],e.data[r+1],e.data[r+2]);e.data[r+0]=a,e.data[r+1]=a,e.data[r+2]=a,e.data[r+3]=255}return e}function U(e){const t=E(e),{width:o,height:n,data:r}=t,a=function(e){let t=0;for(let o=0;o<e.length-1;o+=4)t+=e[o];return Math.round(t/(e.length/4))}(r),l=r[0]>a?[0,255]:[255,0];for(let s=0;s<o;s++)for(let e=0;e<n;e++){const t=4*(e*o+s),n=r[t]>=a?l[0]:l[1];r[t]=n,r[t+1]=n,r[t+2]=n,r[t+3]=255}return t}function _(e){return new Promise(((t,o)=>{const n=new Image;n.onload=()=>t(n),n.onerror=e=>o(e),n.src=e}))}function j(e,t){const o=document.createElement("canvas");return o.width=e,o.height=t,o}function D(e,t=!1){const{width:o,height:n,data:r}=e,a=[0,1,2],l=a.map((e=>r[e])),s=[];if(t)for(let i=0;i<n;i++){let e=0;for(let t=0;t<o;t++){const n=4*(i*o+t);e+=a.every((e=>l[e]===r[n+e]))?0:1}s.push(e)}else for(let i=0;i<o;i++){let e=0;for(let t=0;t<n;t++){const n=4*(t*o+i);e+=a.every((e=>l[e]===r[n+e]))?0:1}s.push(e)}return s}function M(e){const t=[];let o=0,n=0;return e.forEach((e=>{e?(o+=1,n&&(t.push({background:!0,value:n}),n=0)):(n+=1,o&&(t.push({foreground:!0,value:o}),o=0))})),o&&t.push({foreground:!0,value:o}),n&&t.push({background:!0,value:n}),t}function $(e){return e.reduce(((e,t)=>t.foreground?Math.max(e,t.value):e),0)}function O(e,t){const o=[];let n=[];return e.forEach((e=>{if(n.length){n.push(e);const r=n.reduce(((e,t)=>e+t.value),0);(r>=t||Math.pow(r-t,2)<4)&&(o.push({foreground:!0,value:r}),n=[])}else e.foreground&&e.value<t?n=[e]:o.push(e)})),o}function L(e){const t=[];let o=0;return e.forEach((e=>{e.foreground&&t.push({offset:o,size:e.value}),o+=e.value})),t}function q(e){const t=E(e),{width:o,height:n,data:r}=t,a=function(e){let t=0,o=Array(256).fill(0),n=e.length;for(;t<n;)o[e[t++]]++;let r=0;for(let c=0;c<256;c++)r+=c*o[c];let a=0,l=0,s=0,i=0,u=0;for(let c=0;c<256;c++){if(a+=o[c],0===a)continue;if(l=n-a,0===l)break;s+=c*o[c];let e=a*l*(s/a-(r-s)/l)**2;e>i&&(i=e,u=c)}return u}(r),l=r[0]>a?[0,1]:[1,0],s=new Uint8Array(o*n);for(let i=0;i<o;i++)for(let e=0;e<n;e++){const t=e*o+i,n=r[4*t]>a?l[0]:l[1];s.set([n],t)}return s}async function N(e,t){return function(e){const{naturalWidth:t,naturalHeight:o}=e,n=j(t,o).getContext("2d");n.drawImage(e,0,0);const r=U(n.getImageData(0,0,t,o)),a=j(t,o).getContext("2d");a.putImageData(r,0,0);const l=M(D(r,!0)),s=M(D(r,!1)),i=Math.max($(l),$(s)),u=L(O(l,i)),c=[];return u.forEach((e=>{L(O(M(D(a.getImageData(0,e.offset,t,e.size),!1)),i)).forEach((t=>{const o=j(t.size,e.size),n=o.getContext("2d"),r=a.getImageData(t.offset,e.offset,t.size,e.size);n.putImageData(r,0,0),c.push({x:t.offset,y:e.offset,width:t.size,height:t.size,canvas:o})}))})),c}(e).map((e=>{var{canvas:o}=e,a=r(e,["canvas"]);t&&console.log(o.toDataURL());const l=q(function(e,t){const o=j(t,t).getContext("2d");return o.drawImage(e,0,0,e.width,e.height,0,0,t,t),o.getImageData(0,0,t,t)}(o,8));return n(n({},a),{hash:l})}))}async function A(e,t){const o=await _(t),a=await N(o,!1),l=a.map(((e,t)=>({name:"abcdefghijklmnopqrstuvwxyz0123456789.-!?"[t],value:e.hash})));const s=await _(e),i=function(e,t){return e.map((e=>{var{hash:o}=e,a=r(e,["hash"]);if(o.every((e=>e===o[0])))return" ";let l=Number.MAX_SAFE_INTEGER,s="*";return t.forEach((e=>{const t=function(e,t){let o=0;return e.forEach(((e,n)=>{o+=e^t[n]})),o}(o,e.value);t<l&&(l=t,s=e.name)})),n(n({},a),{word:s})}))}(await N(s,!1),l);return console.log(i),function(e,t,o){const n=j(t,o),r=n.getContext("2d"),a=e[0];return r.fillStyle="#000",r.strokeStyle="#000",r.font=`${Math.floor(a.width)}px -apple-system, Arial, sans-serif`,r.textAlign="center",r.textBaseline="middle",e.forEach((e=>{r.fillText(e.word,e.x+Math.round(e.width/2),e.y+Math.round(e.height/2),e.width)})),n.toDataURL()}(i,s.naturalWidth,s.naturalHeight)}P.render=function(e,t,o,n,r,a){const l=p("WordIcon");return c(),i("section",{class:["words-panel",{"words-panel--vertical":e.vertical}],ref:"container",style:e.groups.style},[(c(!0),i(f,null,h(e.groups.items,((t,o)=>(c(),i("div",{class:"words-panel__groups",key:o,style:t.style},[(c(!0),i(f,null,h(t.items,((t,o)=>(c(),i(l,{key:o,name:t,width:e.size,height:e.size},null,8,["name","width","height"])))),128))],4)))),128))],6)};var R=l({name:"ParsePanel",props:{url:{type:String,default:""}},setup:(e,t)=>{const o=d(null),n=d(""),r=()=>t.emit("close"),a=e=>{o.value.contains(e.target)||r()};return m((()=>{document.body.addEventListener("click",a,!1),(async()=>{try{n.value=await A(e.url,"/zelda-words/assets/map.56d06721.jpeg")}catch(t){console.log(t),n.value=""}})()})),g((()=>{document.body.removeEventListener("click",a,!1)})),{container:o,resultImage:n,close:r}}});const W={ref:"container",class:"parse-panel"},B={key:1,class:"parse-panel__message"};R.render=function(e,t,o,n,r,a){return c(),i("section",W,[w("span",{class:"parse-panel__close",onClick:t[1]||(t[1]=(...t)=>e.close&&e.close(...t))},"×"),e.resultImage?(c(),i("img",{key:0,class:"parse-panel__result",src:e.resultImage},null,8,["src"])):(c(),i("span",B," 图片解析中...... "))],512)};var F=l({name:"Download",props:{url:{type:String,default:""}},setup:(e,t)=>{const o=d(null),n=e=>{o.value.contains(e.target)||t.emit("close")};return m((()=>{document.body.addEventListener("click",n,!1)})),g((()=>{document.body.removeEventListener("click",n,!1)})),{container:o}}});const V={ref:"container",class:"download"};F.render=function(e,t,o,n,r,a){return c(),i("section",V,[w("img",{src:e.url},null,8,["src"])],512)};var H=l({name:"App",components:{WordsPanel:P,ParsePanel:R,Download:F},setup:()=>{const e=d("60"),t=d("#13c2fe"),o=d("#12181a"),n=d(!1),r=d("hello world"),a=d(null),l=d(!1),i=s((()=>{let t=Number(e.value);return t=t%2==0?t:t-1,t=Math.max(20,t),t=Math.min(200,t),String(t)})),u=d(!1),c=d(""),p=d(!1),f=d("");return{size:e,limitSize:i,resetSize:()=>{e.value=i.value},fontColor:t,backgroundColor:o,vertical:n,words:r,loading:l,wordsPanel:a,downloadImage:async()=>{const e=a.value||{download:()=>{}};l.value=!0;const t=await e.download();t&&(c.value=t,u.value=!0),l.value=!1},uploadImage:({target:e})=>{const[t]=e.files;f.value=URL.createObjectURL(t),p.value=!0,e.value=""},parseImageUrl:f,showParsePanel:p,showDownload:u,downloadUrl:c}}});const T={class:"container"},G={class:"header"},J={class:"color-input",for:"font-color-input"},X=w("span",null,"Font Color：",-1),K={class:"color-input",for:"background-color-input"},Q=w("span",null,"Background Color：",-1),Y={class:"color-input",for:"vertical-radio"},Z=w("span",null,"Vertical：",-1),ee={class:"color-input",for:"font-size-input"},te=w("span",null,"Font Size：",-1),oe={class:"button-input",for:"image-upload"},ne=w("span",null,"Parse Image",-1),re={class:"content"},ae={class:"results"};H.render=function(e,t,o,n,r,a){const l=p("WordsPanel"),s=p("ParsePanel"),d=p("Download");return c(),i("main",T,[w("section",G,[w("label",J,[X,v(w("input",{type:"color",id:"font-color-input","onUpdate:modelValue":t[1]||(t[1]=t=>e.fontColor=t)},null,512),[[y,e.fontColor]])]),w("label",K,[Q,v(w("input",{type:"color",id:"background-color-input","onUpdate:modelValue":t[2]||(t[2]=t=>e.backgroundColor=t)},null,512),[[y,e.backgroundColor]])]),w("label",Y,[Z,v(w("input",{type:"checkbox","onUpdate:modelValue":t[3]||(t[3]=t=>e.vertical=t)},null,512),[[b,e.vertical]])]),w("label",ee,[te,v(w("input",{type:"number",id:"font-size-input",min:"20",max:"200",step:"2","onUpdate:modelValue":t[4]||(t[4]=t=>e.size=t),onBlur:t[5]||(t[5]=(...t)=>e.resetSize&&e.resetSize(...t))},null,544),[[y,e.size]])]),w("label",oe,[ne,w("input",{type:"file",id:"image-upload",accept:"image/*",onChange:t[6]||(t[6]=(...t)=>e.uploadImage&&e.uploadImage(...t))},null,32)]),w("span",{class:"button-input",onClick:t[7]||(t[7]=(...t)=>e.downloadImage&&e.downloadImage(...t))},k(e.loading?"Download...":"Download"),1)]),w("section",re,[v(w("textarea",{class:"words",placeholder:"input...","onUpdate:modelValue":t[8]||(t[8]=t=>e.words=t)},null,512),[[y,e.words]]),w("div",ae,[w(l,{ref:"wordsPanel",words:e.words,size:e.limitSize,vertical:e.vertical,fontColor:e.fontColor,backgroundColor:e.backgroundColor},null,8,["words","size","vertical","fontColor","backgroundColor"])])]),e.showParsePanel?(c(),i(s,{key:0,url:e.parseImageUrl,onClose:t[9]||(t[9]=t=>e.showParsePanel=!1)},null,8,["url"])):u("",!0),e.showDownload?(c(),i(d,{key:1,url:e.downloadUrl,onClose:t[10]||(t[10]=t=>e.showDownload=!1)},null,8,["url"])):u("",!0)])},function(e){const t="ICON_FONT_SCRIPT";if(document.querySelector(`#${t}`)||!e)return;const o=document.createElement("script");o.id=t,document.body.appendChild(o),o.src=e}("//at.alicdn.com/t/font_2375469_s4wmtifuqro.js"),x(H).mount("#app");
