var e=Object.assign;import{D as t,E as o,a as n,d as a,b as r,c as l,e as s,f as i,o as c,r as u,g as d,F as p,h as m,i as h,j as g,k as f,w,v as y,l as v,t as b,m as C}from"./vendor.37ca8f14.js";function k(e){return new Promise(((t,o)=>{const n=new Image;n.onload=()=>t(n),n.onerror=e=>o(e),n.src=e}))}async function x(t){const a=Math.min(t.size,16),r=function(e){const t=new o;return t.setEncodingHint(!0),t.setErrorCorrectionLevel(n.H),t.write(e.message),t.make(),t.toDataURL(e.msize,e.margin)}({message:t.message,msize:a,margin:0}),l=await k(r),{naturalWidth:s,naturalHeight:i}=l;if(s>t.width||i>t.height){if(a<2)throw console.log("二维码塞不下呀",{naturalWidth:s,naturalHeight:i},r),new Error("图片尺寸太小无法写入关联信息，请避免宽或高尺寸过小！");return x(e(e({},t),{size:Math.floor(a/2)}))}return l}async function z(e,t){const o=(await async function(e){const t=document.createElement("canvas");t.width=e.width,t.height=e.height;const o=await x(e),{naturalWidth:n,naturalHeight:a}=o,r=Math.floor((e.width-n)/2),l=Math.floor((e.height-a)/2),s=t.getContext("2d");return s.fillStyle="#ffffff",s.fillRect(0,0,e.width,e.height),s.drawImage(o,r,l),t}(t)).getContext("2d").getImageData(0,0,t.width,t.height),{width:n,height:a,data:r}=o;for(let l=0;l<n;l++)for(let t=0;t<a;t++){const o=4*(l+t*n),a=255===r[o]?1:0;e[o]%2!==a&&(e[o]+=a?1:-1)}return e}async function P(e){const o=await k(e),n=document.createElement("canvas"),{naturalWidth:a,naturalHeight:r}=o;n.width=a,n.height=r;const l=n.getContext("2d");l.drawImage(o,0,0);const s=l.getImageData(0,0,a,r);for(let t=0;t<s.width;t++)for(let e=0;e<s.height;e++){const o=4*(t+e*a),n=s.data[o]%2?255:0;s.data[o]=n,s.data[o+1]=n,s.data[o+2]=n,s.data[o+3]=255}return l.clearRect(0,0,a,r),l.putImageData(s,0,0),function(e){return(new t).scan(e).then((e=>e.data))}(n.toDataURL())}async function I(e,t){if(!e)return Promise.resolve();const o=await a.toPixelData(e,{filter:e=>function(e){e instanceof SVGElement&&Array.from(e.querySelectorAll("use")||[]).forEach((t=>{const o=t.getAttribute("xlink:href");if(o&&!e.querySelector(o)){const t=document.querySelector(o);t&&e.insertBefore(t.cloneNode(!0),e.children[0])}}));return!0}(e)}),n=await z(o,t),r=function(e){const t=document.createElement("canvas");return t.width=e.width,t.height=e.height,t.getContext("2d").putImageData(e,0,0),t}(new ImageData(n,t.width,t.height));return new Promise((e=>{r.toBlob((t=>{const o=URL.createObjectURL(t),n=document.createElement("a");n.download=`zelda-words-${Date.now()}.png`,n.href=o,n.click(),e(o)}))}))}!function(e=".",t="__import__"){try{self[t]=new Function("u","return import(u)")}catch(o){const n=new URL(e,location),a=e=>{URL.revokeObjectURL(e.src),e.remove()};self[t]=e=>new Promise(((o,r)=>{const l=new URL(e,n);if(self[t].moduleMap[l])return o(self[t].moduleMap[l]);const s=new Blob([`import * as m from '${l}';`,`${t}.moduleMap['${l}']=m;`],{type:"text/javascript"}),i=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(s),onerror(){r(new Error(`Failed to import: ${e}`)),a(i)},onload(){o(self[t].moduleMap[l]),a(i)}});document.head.appendChild(i)})),self[t].moduleMap={}}}("/zelda-words/assets/");var S=r({name:"WordIcon",props:{name:{type:String,required:!0},width:{type:[Number,String],default:""},height:{type:[Number,String],default:""},color:{type:String,default:""},opacity:{type:String,default:""}},setup:e=>({fullName:l((()=>`#icon-${e.name}`)),iconStyle:l((()=>{const t={};return e.color&&(t.color=e.color),null!=e.width&&(t.width="number"==typeof e.width?`${e.width}px`:e.width),null!=e.height&&(t.height="number"==typeof e.height?`${e.height}px`:e.height),null!=e.opacity&&(t.opacity=e.opacity),t}))})});S.render=function(e,t,o,n,a,r){return c(),s("svg",{class:"word-icon","aria-hidden":"true",style:e.iconStyle},[e.name?(c(),s("use",{key:0,"xlink:href":e.fullName},null,8,["xlink:href"])):i("",!0)],4)};var U={0:"0",1:"1",2:"2",3:"3",4:"4",5:"5",6:"6",7:"7",8:"8",9:"9",a:"a",b:"b",c:"c",d:"d",e:"e",f:"f",g:"g",h:"h",i:"i",j:"j",k:"k",l:"l",m:"m",n:"n",o:"o",p:"p",q:"q",r:"r",s:"s",t:"t",u:"u",v:"v",w:"w",x:"x",y:"y",z:"z",".":"period","!":"exclam","?":"question","-":"hyphen"},L=r({name:"WordsPanel",components:{WordIcon:S},props:{words:{type:String,required:!0},size:{type:String,default:"60"},fontColor:{type:String,required:!0},backgroundColor:{type:String,required:!0},vertical:{type:Boolean,default:!1}},setup:e=>{const t=u(null),o=l((()=>{let t=0,o=0;const n=Number(e.size),a=e.words.toLowerCase().split("\n").map((a=>{const r=a.length*n;t=Math.max(r,t),o+=Number(n);return{style:e.vertical?{width:`${n}px`,height:`${r}px`}:{width:`${r}px`,height:`${n}px`},items:a.split("").map((e=>U[e]||""))}}));t+=2*n,o+=2*n;const r=e.vertical?o:t,l=e.vertical?t:o;return{items:a,containerWidth:r,containerHeight:l,style:{width:`${r}px`,height:`${l}px`,padding:`${n}px`,color:e.fontColor,backgroundColor:e.backgroundColor}}}));return{container:t,groups:o,download:()=>I(t.value,{size:Number(e.size),message:e.words,width:o.value.containerWidth,height:o.value.containerHeight}).catch((e=>{window.alert(e.message||"图片导出出错！"),console.log(e)}))}}});L.render=function(e,t,o,n,a,r){const l=d("WordIcon");return c(),s("section",{class:["words-panel",{"words-panel--vertical":e.vertical}],ref:"container",style:e.groups.style},[(c(!0),s(p,null,m(e.groups.items,((t,o)=>(c(),s("div",{class:"words-panel__groups",key:o,style:t.style},[(c(!0),s(p,null,m(t.items,((t,o)=>(c(),s(l,{key:o,name:t,width:e.size,height:e.size},null,8,["name","width","height"])))),128))],4)))),128))],6)};var $=r({name:"ParsePanel",props:{url:{type:String,default:""}},setup:(e,t)=>{const o=u(null),n=u(!1),a=u(""),r=l((()=>n.value?"图片解析中......":a.value)),s=()=>t.emit("close"),i=e=>{o.value.contains(e.target)||s()};return h((()=>{document.body.addEventListener("click",i,!1),(async()=>{n.value=!0;try{a.value=await P(e.url)}catch(t){console.log(t),a.value=t.message||"图片信息解析出错！"}n.value=!1})()})),g((()=>{document.body.removeEventListener("click",i,!1)})),{container:o,message:r,close:s}}});const E={ref:"container",class:"parse-panel"};$.render=function(e,t,o,n,a,r){return c(),s("section",E,[f("span",{class:"parse-panel__close",onClick:t[1]||(t[1]=(...t)=>e.close&&e.close(...t))},"×"),w(f("textarea",{class:"parse-panel__message","onUpdate:modelValue":t[2]||(t[2]=t=>e.message=t)},null,512),[[y,e.message]])],512)};var R=r({name:"App",components:{WordsPanel:L,ParsePanel:$},setup:()=>{const e=u("60"),t=u("#13c2fe"),o=u("#12181a"),n=u(!1),a=u("hello world"),r=u(null),s=u(!1),i=l((()=>Number(e.value)<20?"20":e.value)),c=u(!1),d=u("");return{size:e,limitSize:i,fontColor:t,backgroundColor:o,vertical:n,words:a,loading:s,wordsPanel:r,downloadImage:async()=>{const e=r.value||{download:()=>{}};s.value=!0,await e.download(),s.value=!1},uploadImage:({target:e})=>{const[t]=e.files;d.value=URL.createObjectURL(t),c.value=!0,e.value=""},parseImageUrl:d,showParsePanel:c}}});const _={class:"container"},j={class:"header"},q={class:"color-input",for:"font-color-input"},D=f("span",null,"Font Color：",-1),W={class:"color-input",for:"background-color-input"},N=f("span",null,"Background Color：",-1),M={class:"color-input",for:"vertical-radio"},H=f("span",null,"Vertical：",-1),O={class:"color-input",for:"font-size-input"},V=f("span",null,"Font Size：",-1),F={class:"button-input",for:"image-upload"},B=f("span",null,"Parse Image",-1),A={class:"content"},T={class:"results"};R.render=function(e,t,o,n,a,r){const l=d("WordsPanel"),u=d("ParsePanel");return c(),s("main",_,[f("section",j,[f("label",q,[D,w(f("input",{type:"color",id:"font-color-input","onUpdate:modelValue":t[1]||(t[1]=t=>e.fontColor=t)},null,512),[[y,e.fontColor]])]),f("label",W,[N,w(f("input",{type:"color",id:"background-color-input","onUpdate:modelValue":t[2]||(t[2]=t=>e.backgroundColor=t)},null,512),[[y,e.backgroundColor]])]),f("label",M,[H,w(f("input",{type:"checkbox","onUpdate:modelValue":t[3]||(t[3]=t=>e.vertical=t)},null,512),[[v,e.vertical]])]),f("label",O,[V,w(f("input",{type:"number",id:"font-size-input",min:"20",max:"300",step:"2","onUpdate:modelValue":t[4]||(t[4]=t=>e.size=t)},null,512),[[y,e.size]])]),f("label",F,[B,f("input",{type:"file",id:"image-upload",accept:"image/*",onChange:t[5]||(t[5]=(...t)=>e.uploadImage&&e.uploadImage(...t))},null,32)]),f("span",{class:"button-input",onClick:t[6]||(t[6]=(...t)=>e.downloadImage&&e.downloadImage(...t))},b(e.loading?"Download...":"Download Image"),1)]),f("section",A,[w(f("textarea",{class:"words",placeholder:"input...","onUpdate:modelValue":t[7]||(t[7]=t=>e.words=t)},null,512),[[y,e.words]]),f("div",T,[f(l,{ref:"wordsPanel",words:e.words,size:e.limitSize,vertical:e.vertical,fontColor:e.fontColor,backgroundColor:e.backgroundColor},null,8,["words","size","vertical","fontColor","backgroundColor"])])]),e.showParsePanel?(c(),s(u,{key:0,url:e.parseImageUrl,onClose:t[8]||(t[8]=t=>e.showParsePanel=!1)},null,8,["url"])):i("",!0)])},function(e){const t="ICON_FONT_SCRIPT";if(document.querySelector(`#${t}`)||!e)return;const o=document.createElement("script");o.id=t,document.body.appendChild(o),o.src=e}("//at.alicdn.com/t/font_2375469_s4wmtifuqro.js"),C(R).mount("#app");
